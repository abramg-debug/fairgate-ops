<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FairGate Ops Composer (V1)</title>

<style>
:root{
  --bg:#0b1220; --card:#121a2b; --text:#e8eefc; --muted:#9fb0d8;
  --accent:#3b82f6; --ok:#17c964; --err:#f31260; --border:rgba(255,255,255,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg); color:var(--text);
}
.wrap{max-width:960px;margin:28px auto;padding:16px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:0 10px 28px rgba(0,0,0,.35);
  padding:16px;
  margin-bottom:14px;
}
h1{margin:0 0 8px;font-size:20px}
h2{margin:0 0 8px;font-size:16px}
.sub{color:var(--muted);font-size:13px}
label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
input,textarea,select{
  width:100%;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  color:var(--text);
  padding:10px 12px;
}
textarea{min-height:90px;resize:vertical}
.row{display:grid;gap:12px}
.row.two{grid-template-columns:1fr 1fr}
.row.three{grid-template-columns:1fr 1fr 1fr}
.btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
button{
  border:1px solid var(--border);
  background:rgba(255,255,255,.04);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
}
button.primary{background:rgba(59,130,246,.18)}
button.good{background:rgba(23,201,100,.18)}
button.warn{background:rgba(243,18,96,.18)}
.preview{
  white-space:pre-wrap;
  font-family:ui-monospace,Menlo,Consolas,monospace;
  font-size:12px;
  background:rgba(0,0,0,.25);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  min-height:120px;
}
.status{margin-top:8px;font-size:13px}
.ok{color:var(--ok)}
.err{color:var(--err)}
</style>
</head>

<body>
<div class="wrap">

<!-- Preferences -->
<div class="card">
<h1>FairGate Ops Composer (V1)</h1>
<p class="sub">Dispatch & Closure email generator (Gmail Web)</p>

<div class="row three">
  <div>
    <label>To (Google Group)</label>
    <input id="toAddr" placeholder="fairgate-dispatch@yourdomain.com">
  </div>
  <div>
    <label>CC (optional)</label>
    <input id="ccAddr">
  </div>
</div>

<div class="btns">
  <button class="primary" id="savePrefs">Save</button>
  <button id="loadPrefs">Reload</button>
  <button class="warn" id="clearPrefs">Clear</button>
</div>
<div id="prefStatus" class="status"></div>
</div>

<!-- Ticket Fields -->
<div class="card">
<h2>Ticket Fields</h2>

<div class="row two">
  <div>
    <label>Station Name</label>
    <input id="station" list="stations" placeholder="Start typing…">
    <datalist id="stations">
      <option value="Firestone">
      <option value="Willowbrook - Rosa Parks">
      <option value="Lake">
      <option value="Allen">
      <option value="Glendora">
      <option value="San Dimas">
      <option value="La Verne">
      <option value="Pomona">
      <option value="Westlake/MacArthur Partk">
      <option value="North Hollywood - Red">
      <option value="Pershing Square">
      <option value="7th Street/Metro Center">
      <option value="Wilshire/Vermont">
      <option value="Vermont/Santa Monica">
      <option value="Hollywood/Western">
      <option value="Civic Center">
      <option value="LAX/MTC">
      <option value="Dougls">
      <option value="Aviation/Imperial">
      <option value="Norwalk">
      <option value="Wilshire/La Brea">
      <option value="Wilshire/Fairfax">
      <option value="Wilshire/La Cienega">
    </datalist>
  </div>

  <div>
    <label>Faregate ID</label>
    <input id="fgid">
  </div>
</div>

<div class="row two">
  <div>
    <label>Ticket ID</label>
    <div style="display:flex;gap:6px">
      <span style="padding:10px 12px;border:1px solid var(--border);border-radius:12px;font-weight:600">FM-</span>
      <input id="ticketId" placeholder="12345">
    </div>
  </div>

  <div>
    <label>Technician</label>
    <select id="tech">
      <option value="">Select technician…</option>
      <option>Abram Gearig</option>
      <option>Aijaz Sabir</option>
      <option>Asanti Hudson</option>
      <option>Charles Lee</option>
      <option>Demetrius Harper</option>
      <option>Devon Johnson</option>
      <option>Francisco Leal</option>
      <option>Gunsuk Yang</option>
      <option>Hector Moreno</option>
      <option>Jimmy Zone</option>
      <option>Jose Juarez</option>
      <option>Joshua Almeda</option>
      <option>Julio Martinez</option>
      <option>Juan Hernandez</option>
      <option>Pablo Almeda Rodriguez</option>
      <option>Revic Cho</option>
      <option>Roger Diaz</option>
    </select>
  </div>
</div>

<label>Issue Details</label>
<textarea id="issue"></textarea>

<label>Actions Taken</label>
<textarea id="actions"></textarea>

<div class="row two">
  <div>
    <label>Faregate Status</label>
    <select id="statusSel">
      <option value="">Select…</option>
      <option>In Service</option>
      <option>Out of Service</option>
      <option>Degraded</option>
      <option>Monitoring</option>
      <option>Pending Parts</option>
    </select>
  </div>
  <div>
    <label>Cause (if known)</label>
    <input id="cause">
  </div>
</div>

<div class="btns">
  <button class="primary" id="build">Build Emails</button>
  <button id="clearFields">Clear</button>
</div>
<div id="buildStatus" class="status"></div>
</div>

<!-- Outputs -->
<div class="card">
<h2>Outputs</h2>

<label>Dispatch Email</label>
<div id="dispatchPreview" class="preview"></div>
<div class="btns">
  <button class="good" id="copyDispatch">Copy</button>
  <button class="primary" id="openDispatch">Open Gmail</button>
</div>

<label>Ticket Closed Email</label>
<div id="closedPreview" class="preview"></div>
<div class="btns">
  <button class="good" id="copyClosed">Copy</button>
  <button class="primary" id="openClosed">Open Gmail</button>
</div>

<div id="actionStatus" class="status"></div>
</div>

</div>

<script>
const $=id=>document.getElementById(id);
const prefsKey="fairgate_prefs";

function savePrefs(){
  localStorage.setItem(prefsKey,JSON.stringify({
    to:$("toAddr").value,
    cc:$("ccAddr").value
  }));
  $("prefStatus").textContent="Saved";
}
function loadPrefs(){
  const p=JSON.parse(localStorage.getItem(prefsKey)||"{}");
  $("toAddr").value=p.to||"";
  $("ccAddr").value=p.cc||"";
}
function clearPrefs(){
  localStorage.removeItem(prefsKey);
  $("toAddr").value="";$("ccAddr").value="";
}

function gmail(to,cc,subject,body){
  const p=new URLSearchParams({view:"cm",fs:"1",to,su:subject,body});
  if(cc)p.set("cc",cc);
  return "https://mail.google.com/mail/?"+p.toString();
}

function build(){
  const station=$("station").value.trim();
  const fgid=$("fgid").value.trim();
  const ticket=$("ticketId").value.trim()?`FM-${$("ticketId").value.trim()}`:"";
  const issue=$("issue").value.trim();
  const actions=$("actions").value.trim();
  const status=$("statusSel").value;
  const cause=$("cause").value.trim();
  const tech=$("tech").value;

  const dispSub=`Service Dispatched "${station}" – ${fgid} – ${ticket}`;
  const dispBody=[
    "Service Dispatched",
    "",
    `TICKET ID: ${ticket}`,
    `STATION NAME: ${station}`,
    `FAREGATE ID: ${fgid}`,
    `ISSUE DETAILS: ${issue}`,
    `ACTIONS TAKEN: ${actions}`,
    `FAREGATE STATUS: ${status}`,
    `CAUSE (IF KNOWN): ${cause}`
  ].join("\n");

  const closeSub=`Ticket Closed – ${station} – ${fgid} – ${ticket}`;
  const closeBody=[
    "The following ticket has been resolved:",
    "",
    `STATION NAME: ${station}`,
    `FAREGATE ID: ${fgid}`,
    `ISSUE DETAILS: ${issue}`,
    `ACTIONS TAKEN: ${actions}`,
    `FAREGATE STATUS: ${status}`,
    `CAUSE: ${cause}`,
    `TECHNICIAN: ${tech}`
  ].join("\n");

  $("dispatchPreview").textContent=`Subject: ${dispSub}\n\n${dispBody}`;
  $("closedPreview").textContent=`Subject: ${closeSub}\n\n${closeBody}`;

  $("openDispatch").onclick=()=>window.open(gmail($("toAddr").value,$("ccAddr").value,dispSub,dispBody));
  $("openClosed").onclick=()=>window.open(gmail($("toAddr").value,$("ccAddr").value,closeSub,closeBody));
}

$("savePrefs").onclick=savePrefs;
$("loadPrefs").onclick=loadPrefs;
$("clearPrefs").onclick=clearPrefs;
$("build").onclick=build;
$("clearFields").onclick=()=>location.reload();
$("copyDispatch").onclick=()=>navigator.clipboard.writeText($("dispatchPreview").textContent);
$("copyClosed").onclick=()=>navigator.clipboard.writeText($("closedPreview").textContent);

loadPrefs();
</script>
</body>
</html>
